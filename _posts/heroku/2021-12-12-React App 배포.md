---
layout: post
title: "[Heroku] React App ë°°í¬"
categories: [Heroku]
---

Herokuì—ì„œ í”„ë¡ íŠ¸ì—”ë“œ íŒŒì¼ë“¤ì„ ë¹Œë“œí•˜ê³ , ë°°í¬í•©ë‹ˆë‹¤.

> ì œê°€ í”„ë¡ íŠ¸ì—”ë“œë¥¼ í•´ë³´ì§€ ì•Šì•„ì„œ í”„ë¡ íŠ¸ ì„¤ì •ì„ ì˜ ëª¨ë¦…ë‹ˆë‹¤.
> 
> ì˜ëª»ì ìš©í•˜ê±°ë‚˜ í•„ìš”í•˜ì§€ ì•Šì€ ì˜µì…˜ì„ ì ìš©í–ˆë‹¤ë©´ ëŒ“ê¸€ë¡œ ì•Œë ¤ì£¼ì„¸ìš”!

# Environment
- heroku/7.59.2 
- darwin-x64 
- node-v12.21.0

# Create new app

1. [https://dashboard.heroku.com/apps](https://dashboard.heroku.com/apps) ì— ì ‘ì†í•œ í›„ `Create new app` ì„ í´ë¦­í•˜ì—¬ ì•±ì„ ìƒì„±í•©ë‹ˆë‹¤.
   ![image](https://user-images.githubusercontent.com/56301069/145707053-b59973c1-8302-42fe-a7d4-91bf72c92541.png)


2. ì•±ì˜ ì´ë¦„ì„ ì„¤ì •í•˜ê³  ì•±ì„ ìƒì„±í•©ë‹ˆë‹¤.

   ![image](https://user-images.githubusercontent.com/56301069/145707071-ce730dca-5987-48ed-8102-4e8ce9f26d87.png)

3. `Settings` íƒ­ì—ì„œ `Add buildpack` ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
   ![image](https://user-images.githubusercontent.com/56301069/145707074-c5f21ef4-8946-4cb3-b976-ece630b440ac.png)

4. Enter Buildpack URLì— [https://github.com/mars/create-react-app-buildpack](https://github.com/mars/create-react-app-buildpack) ë¥¼ ì…ë ¥í•˜ê³  ì €ì¥í•©ë‹ˆë‹¤.

   ![image](https://user-images.githubusercontent.com/56301069/145707106-bd5b8dbc-9ffa-485b-aadd-d2311bbcb89d.png)

# Application ì„¤ì •
## package.json

package.jsonì— ë‹¤ìŒì„ ì¶”ê°€í•©ë‹ˆë‹¤.

- ì‚¬ìš©í•˜ëŠ” nodeì™€ npm ë²„ì „
- scripts
    - `start`: node <main.jsì˜ ê²½ë¡œ>/main.js
    - `build`: build ìŠ¤í¬ë¦½íŠ¸
    - `heroku-prebuild`: npm install. ë¹Œë“œë¥¼ ì‹¤í–‰í•˜ê¸° ì „ ì‹¤í–‰í•  ìŠ¤í¬ë¦½íŠ¸

ì˜ˆë¥¼ ë“¤ì–´, í˜„ì¬ ì €í¬ í”„ë¡œì íŠ¸ì˜ `package.json`ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```bash
{
  "name": "drop-the-code",
  "version": "1.0.0",
  "description": "frontend part of drop the code web application",
  "main": "src/index.tsx",
  "engines":{
    "node":"16.x",
    "npm":"8.x"
  },
  "scripts": {
    "start": "node dist/server/main.js",
    "build": "npm run build-client && npm run build-server",
		"build-client": "webpack --node-env production --config webpack.prod.ts",
    "build-server": "webpack --node-env production --config webpack.server.ts",
    "heroku-prebuild": "npm install"
		...
  },
	...
}
```

## Procfile

ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•©ë‹ˆë‹¤.

ë£¨íŠ¸ ë””ë ‰í† ë¦¬ëŠ” ë°°í¬í•˜ê³ ì í•˜ëŠ” í´ë”ì˜ ìµœìƒìœ„ í´ë”ì…ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì€ í”„ë¡œì íŠ¸ êµ¬ì¡°ì—ì„œ í”„ë¡ íŠ¸ì—”ë“œì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ëŠ” `frontend/`ì…ë‹ˆë‹¤.

```bash
â¯ ls
README.md backend/ frontend/
```

ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ `Procfile`ì„ ìƒì„±í•©ë‹ˆë‹¤.

ê·¸ í›„ ì•ˆì— `web: npm start` ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

```bash
# ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ
â¯ echo "web: npm start" >> Procfile
```

# Deploy
## Heroku Git Repository  ì¶”ê°€

`Settings` íƒ­ì—ì„œ App Informationì„ ë³´ì‹œë©´ `Heroku git URL`ì´ ì í˜€ ìˆìŠµë‹ˆë‹¤.
![image](https://user-images.githubusercontent.com/56301069/145707112-8ba9a635-7d5d-4b52-9af1-4c97472147c3.png)

í•´ë‹¹ ì €ì¥ì†Œë¥¼ í”„ë¡œì íŠ¸ì— ì¶”ê°€í•©ë‹ˆë‹¤. í”„ë¡œì íŠ¸ì—ì„œ

```bash
$ git remote add <ì›ê²© ì €ì¥ì†Œ ì´ë¦„> <Heroku git URL>
```

ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

### Backend í´ë”ì™€ Frontend í´ë” ê°ê°ì„ ì €ì¥ì†Œì— ì¶”ê°€

ì €í¬ í”„ë¡œì íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì´ backend í´ë”ì™€ frontend í´ë”ê°€ í•˜ë‚˜ì˜ ì €ì¥ì†Œì— ë“¤ì–´ìˆìŠµë‹ˆë‹¤.

```bash
â¯ ls
README.md backend/ frontend/
```

backendì—ì„œëŠ” `java jar`ë¡œ, frontëŠ” `npm`ìœ¼ë¡œ ë°°í¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. backendì™€ frontendì—ì„œ ì‹¤í–‰í•´ì•¼ í•  ìŠ¤í¬ë¦½íŠ¸ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì—, ë‘˜ì„ ê°™ì€ í—¤ë¡œì¿  ì €ì¥ì†Œì— ì¶”ê°€í•˜ë©´ ì•ˆë©ë‹ˆë‹¤.

ê·¸ëŸ¬ë¯€ë¡œ `front`ì™€ `backend`ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë‹¤ë¥¸ ì›ê²© ì €ì¥ì†Œ ì´ë¦„ìœ¼ë¡œ ê°ê° ì €ì¥ì†Œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```bash
$ git remote add heroku-front <Heroku front git URL>
$ git remote add heroku-back <Heroku backend git URL>
```

## í—¤ë¡œì¿  ì €ì¥ì†Œì— ì»¤ë°‹ í‘¸ì‹œ
í”„ë¡ íŠ¸ì˜ ë³€ê²½ ì‚¬í•­ì„ ì»¤ë°‹í•©ë‹ˆë‹¤.

```bash
â¯ git add .
â¯ git commit -m 'í”„ë¡ íŠ¸ì—”ë“œ í—¤ë¡œì¿  ë°°í¬ ì„¤ì • ì¶”ê°€'
```

### í”„ë¡œì íŠ¸ ì €ì¥ì†Œì— í”„ë¡ íŠ¸ì™€ ë°±ì—”ë“œ í´ë”ê°€ ê°™ì´ ìˆì„ ê²½ìš°

ë‹¤ìŒê³¼ ê°™ì´ í”„ë¡œì íŠ¸ ì €ì¥ì†Œì— í”„ë¡ íŠ¸ì™€ ë°±ì—”ë“œ í´ë”ê°€ ê°™ì´ ìˆë‹¤ë©´,

```bash
â¯ ls
README.md backend/ frontend/
```

`git subtree split`ì„ ì´ìš©í•˜ì—¬ í”„ë¡ íŠ¸í´ë”ë§Œì„ ë”°ë¡œ ë¶„ë¦¬í•˜ê³  í—¤ë¡œì¿  ì €ì¥ì†Œì— í‘¸ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.

```bash
# git push -f <ì›ê²© ì €ì¥ì†Œ ì´ë¦„> `git subtree split --prefix <ë°°í¬í•  í´ë” ì´ë¦„>`:master
# -f: ê°•ì œ í‘¸ì‹œ. ë¡œì»¬ì˜ ì»¤ë°‹ ì´ë ¥ì„ ê°•ì œë¡œ ì›ê²©ì— ì €ì¥

# git subtree split --prefix <ë°°í¬í•  í´ë” ì´ë¦„>: <ë°°í¬í•  í´ë” ì´ë¦„>ë§Œì„ ê°€ì§„ ìƒˆë¡œìš´ ì»¤ë°‹ ìƒì„±

# git push -f <ì›ê²© ì €ì¥ì†Œ ì´ë¦„> <ì»¤ë°‹>:<ë¸Œëœì¹˜>
# <ì›ê²© ì €ì¥ì†Œ>ì— ìˆëŠ” <ë¸Œëœì¹˜>ì— <ì»¤ë°‹>ì„ ì¶”ê°€

â¯ git push -f heroku-front `git subtree split --prefix frontend`:master
```

### í”„ë¡œì íŠ¸ì— í”„ë¡ íŠ¸ í´ë”ë§Œ ìˆì„ ê²½ìš°

ë‹¤ìŒê³¼ ê°™ì´ í”„ë¡œì íŠ¸ ì €ì¥ì†Œì— `.git` í´ë”ì™€ í”„ë¡ íŠ¸íŒŒì¼ì´ ê°™ì´ ìˆë‹¤ë©´,

```bash
â¯ ls -a
.git .gitignore node_modules public src
```

í—¤ë¡œì¿  ì„¤ì •ì„ ì¶”ê°€í•œ ì»¤ë°‹ì„ ë°”ë¡œ í—¤ë¡œì¿  ì €ì¥ì†Œì— í‘¸ì‹œí•©ë‹ˆë‹¤.

```bash
â¯ git push heroku-front master
```

# Check

ë°°í¬ê°€ ëë‚˜ê³  ë‚˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë°°í¬ëœ ì›¹ ì‚¬ì´íŠ¸ì˜ ì£¼ì†Œê°€ ë‚˜ì˜µë‹ˆë‹¤.

í•´ë‹¹ ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ì„±ê³µì ìœ¼ë¡œ ë°°í¬ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë´…ë‹ˆë‹¤.

```bash
remote: 
remote: -----> Compressing...
remote:        Done: 55.3M
remote: -----> Launching...
remote:        Released v52
remote:        https://dropthecode.herokuapp.com/ deployed to Heroku
remote: 
remote: Verifying deploy... done.
To https://git.heroku.com/dropthecode.git
```

ì›¹ í˜ì´ì§€ê°€ ì •ìƒì ìœ¼ë¡œ ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ‘

![image](https://user-images.githubusercontent.com/56301069/145707196-0c6cfda5-4f96-4fc8-99f5-9fea37b16bd6.png)
